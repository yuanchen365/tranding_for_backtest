# 回測平台 Web UI 需求初稿

本文件對齊既有 SSOT 規格，描述未來商業化 Web 介面的初步需求。分為功能模組、互動流程與技術架構三部分，提供設計與工程參考。

---

## 1. 首頁儀表板（Dashboard）

### 1.1 參數輸入區
- **商品/資料來源**：下拉式選單，可切換本地 CSV 與 API（Shioaji、FinLab 等）；支援拖曳上傳與歷史檔案列表。
- **日期區間**：日曆選擇器；預設使用設定檔中的 `run.start`、`run.end`；加入「快速選擇」(近 1 年、近 3 年)。
- **策略與參數**：
  - 勾選 S1–S4 策略卡片（附 tooltip 說明）。
  - `N/L` 網格以表格形式可編輯；提供「新增一列」「匯入 CSV」。
  - 滑價、成本欄位支援覆寫（單一值或 per-row）。
- **預設範例**：面板右側呈現「範例組合」，一鍵載入新手設定。

### 1.2 即時診斷
- 顯示資料摘要：原始筆數、清理後筆數、缺少交易日數、缺價筆數。
- 提供「下載 Data Quality CSV」按鈕，可直接導出 `Symbol_data_quality.csv`。
- 當資料品質不足時，以警示卡顯示（例：缺日 > 50），並附提示「嘗試改用 API 重抓」。

### 1.3 任務執行區
- **任務卡**：列出排程/執行/完成狀態，顯示參數、開始時間與預估剩餘時間。
- **進度條**：以策略為單位更新，顯示當前處理的策略或 N/L 組合。
- **日誌面板**：滾動顯示 CLI 輸出精華（資料載入、策略完成、警告）。
- **控制按鈕**：提供「取消任務」「複製設定重跑」「查看輸出」。

---

## 2. 成果瀏覽（Results Explorer）

### 2.1 互動圖表
- 使用 Plotly/ECharts 呈現：
  - 逐日權益曲線（可切換策略、顯示總權益）。
  - 淨利與最大回撤之雙座標圖。
  - 逐月績效矩陣（Heatmap）與勝率柱狀圖。
- 支援指標切換按鈕（淨利、Sharpe、最大回撤、Sortino、CAGR）。
- 滑鼠 hover 顯示詳細資訊，提供導出圖片（PNG/SVG）功能。

### 2.2 參數網格視覺化
- 整合 `*_param_grid_summary.csv`，以資料表或熱圖呈現：
  - 行：不同 N/L 組合；列：Sharpe、淨利、最大回撤。
  - 可使用滑桿/篩選器（如 Sharpe > 1.0）快速找出候選組合。
- 點擊行列可展開「策略細節」，顯示各策略指標與連結至對應報表/圖檔。

### 2.3 檔案管理
- 集中檔案列表：Excel、CSV、PNG、Data Quality、Param Grid Summary。
- 支援：
  - 單檔下載。
  - 多選後「打包 ZIP」。
  - 生成分享連結（設定有效期限/密碼）— 留待進階版本。

---

## 3. 使用者體驗（UX）提案

### 3.1 導引式流程
- 首次登入顯示「操作導覽」，包含策略介紹、資料上傳、回測、檢視結果四步驟。
- 每個面板附「說明」圖示，點擊展開文字與影片連結。

### 3.2 權限與環境
- 於儀表板顯示目前環境（測試/正式），允許企業用戶於不同專案間切換。
- 權限層級：擁有者（管理方案與金鑰）、分析師（執行回測）、觀察者（瀏覽結果）。

### 3.3 錯誤處理
- 發生錯誤時，以狀態卡顯示：
  - 問題描述（例：Shioaji 登入失敗、CSV 欄位缺失）。
  - 建議動作（重新輸入憑證、檢查欄位名稱）。
  - 提供複製錯誤代碼與聯絡客服按鈕。

---

## 4. 技術架構建議

### 4.1 前端
- React + TypeScript。
- UI Framework：Ant Design（表單與表格便利），Chart library：Plotly.js 或 ECharts。
- 使用 React Query/SWR 處理資料快取與輪詢任務狀態。

### 4.2 後端
- 保留現有 Python 模組，透過 FastAPI 封裝：
  - `/api/job` 提交回測任務（接收符號、策略、param grid 等）。
  - `/api/job/{id}` 查詢狀態與結果； `/api/files/{id}` 提供檔案下載。
- 任務排程：Celery + Redis（或 RQ + Redis）；長任務可拆分成多工作節點。
- 檔案存儲：本機／NAS／S3 皆可；需保存 Excel/CSV/PNG 及 Data Quality/Param Grid Summary。

### 4.3 即時溝通
- 前端定期輪詢（5–10 秒）或用 WebSocket 推送任務狀態與日誌更新。
- 任務完成後可推播通知（Email、Webhook）。

---

## 5. 後續拓展
- 採用角色與方案限制（免費版 N/L 條數、CSV 檔案大小上限）。
- 增加範例資料庫與策略模組商店。
- 企業版提供 API Token 與專用環境（不可與一般用戶混用）。

此規劃可在保持現有 SSOT 規格下，快速導入圖形化介面，讓非工程背景的使用者也能同樣遵守策略與輸出標準。後續可依此文件進行 UI 原型設計與工作量預估。
